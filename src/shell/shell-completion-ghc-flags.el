;; shell-completion-ghc-flags.el --- -*- lexical-binding: t; -*-

;; Copyright (C) Sergey Vinokurov
;;
;; Author: Sergey Vinokurov <serg.foo@gmail.com>
;; Created:  8 January 2025
;; Description:

(defvar compile--strict-mode)

(require 'recompile-init)

;;;###autoload (autoload 'pcomplete-ghc-flags "shell-completion-ghc-flags" nil)
(defvar pcomplete-ghc-flags
  (eval-when-compile
    (let* ((known-options '(("--show-iface" (pcmpl-haskell-hi-files))
                            (("--exclude-module" "-dep-makefile" "-o") (pcmpl-entries))
                            (("-i" "-I" "-L" "--dumpdir" "-hidir" "-odir" "-outputdir" "-stubdir" "-tmpdir" "-working-dir") (pcmpl-dirs))
                            (("-package-db" "-package-env") (pcmpl-entries-ignoring-common))
                            ("-dth-dec-file" (pcmpl-entries))
                            "-v"
                            "-v1"
                            "-v2"
                            "-v3"
                            "-O"
                            "-O1"
                            "-O0"
                            "-O2"
                            "-fdiagnostics-color=always"
                            "-fdiagnostics-color=auto"
                            "-fdiagnostics-color=never"
                            "-rtsopts"
                            "-rtsopts=none"
                            "-rtsopts=some"
                            "-rtsopts=all"))
           (known-options-names
            (--mapcat (if (stringp it)
                          (list (seq-take-while (lambda (c) (not (eq c ?=))) it))
                        (let ((fst (car it)))
                          (if (stringp fst)
                              (list fst)
                            fst)))
                      known-options))
           (known-options-names-ht (alist->hash-table (--map (cons it t) known-options-names))))
      (append known-options
              (if (executable-find "ghc")
                  (--filter (not (gethash it known-options-names-ht))
                            (process-lines "ghc" "--show-options"))
                (if compile--strict-mode
                    (error "The ‘ghc’ executable was not found, cannot query it for the list of options it supports")
                  ;; Fallback
                  '("-fdiagnostics-show-caret"
                    "-fno-diagnostics-show-caret"
                    "-ferror-spans"
                    "-fhide-source-paths"
                    "-fprint-equality-relations"
                    "-fno-print-equality-relations"
                    "-fprint-expanded-synonyms"
                    "-fno-print-expanded-synonyms"
                    "-fprint-explicit-coercions"
                    "-fno-print-explicit-coercions"
                    "-fprint-explicit-foralls"
                    "-fno-print-explicit-foralls"
                    "-fprint-explicit-kinds"
                    "-fno-print-explicit-kinds"
                    "-fprint-explicit-runtime-rep"
                    "-fno-print-explicit-runtime-reps"
                    "-fprint-explicit-runtime-reps"
                    "-fno-print-explicit-runtime-reps"
                    "-fprint-potential-instances"
                    "-fno-print-potential-instances"
                    "-fprint-typechecker-elaboration"
                    "-fno-print-typechecker-elaboration"
                    "-fprint-unicode-syntax"
                    "-fno-print-unicode-syntax"
                    "-fshow-hole-constraints"
                    "-Rghc-timing"

                    "--frontend"
                    "--help"
                    "-?"
                    "--info"
                    "--interactive"
                    "--make"
                    "--mk-dll"
                    "--numeric-version"
                    "--print-libdir"
                    "--show-options"
                    "--supported-extensions"
                    "--supported-languages"
                    "--version"
                    "-V"
                    "-e"
                    "-M"

                    "-C"
                    "-c"
                    "-E"
                    "-F"
                    "-S"
                    "-x"

                    "-ddump-mod-cycles"
                    "-dep-suffix"
                    "-hcsuf"
                    "-hisuf"
                    "-include-pkg-deps"
                    "-osuf"

                    "-keep-hc-file"
                    "-keep-hc-files"
                    "-keep-hi-files"
                    "-no-keep-hi-files"
                    "-keep-llvm-file"
                    "-keep-llvm-files"
                    "-keep-o-files"
                    "-no-keep-o-files"
                    "-keep-s-file"
                    "-keep-s-files"
                    "-keep-tmp-files"

                    "-ddump-hi"
                    "-ddump-hi-diffs"
                    "-ddump-minimal-imports"

                    "-fforce-recomp"
                    "-fno-force-recomp"
                    "-fignore-hpc-changes"
                    "-fno-ignore-hpc-changes"
                    "-fignore-optim-changes"
                    "-fno-ignore-optim-changes"

                    "-fbreak-on-error"
                    "-fno-break-on-error"
                    "-fbreak-on-exception"
                    "-fno-break-on-exception"
                    "-fghci-hist-size="
                    "-flocal-ghci-history"
                    "-fno-local-ghci-history"
                    "-fprint-bind-result"
                    "-fno-print-bind-result"
                    "-fshow-loaded-modules"
                    "-ghci-script"
                    "-ignore-dot-ghci"
                    "-interactive-print"

                    "-clear-package-db"
                    "-distrust"
                    "-distrust-all-packages"
                    "-fpackage-trust"
                    "-global-package-db"
                    "-hide-all-packages"
                    "-hide-package"
                    "-ignore-package"
                    "-no-auto-link-packages"
                    "-no-global-package-db"
                    "-no-user-package-db"
                    "-package"
                    "-package-id"
                    "-this-unit-id"
                    "-trust"
                    "-user-package-db"

                    "-fdefer-out-of-scope-variables"
                    "-fno-defer-out-of-scope-variables"
                    "-fdefer-type-errors"
                    "-fno-defer-type-errors"
                    "-fdefer-typed-holes"
                    "-fno-defer-typed-holes"
                    "-fhelpful-errors"
                    "-fno-helpful-errors"
                    "-fmax-pmcheck-iterations="
                    "-fshow-warning-groups"
                    "-fno-show-warning-groups"
                    "-W"
                    "-w"
                    "-Wall"
                    "-w"
                    "-Wall-missed-specialisations"
                    "-Wno-all-missed-specialisations"
                    "-Wamp"
                    "-Wno-amp"
                    "-Wcompat"
                    "-Wno-compat"
                    "-Wcpp-undef"
                    "-Wdeferred-out-of-scope-variables"
                    "-Wno-deferred-out-of-scope-variables"
                    "-Wdeferred-type-errors"
                    "-Wno-deferred-type-errors"
                    "-Wdeprecated-flags"
                    "-Wno-deprecated-flags"
                    "-Wdeprecations"
                    "-Wno-deprecations"
                    "-Wdodgy-exports"
                    "-Wno-dodgy-exports"
                    "-Wdodgy-foreign-imports"
                    "-Wno-dodgy-foreign-import"
                    "-Wdodgy-imports"
                    "-Wno-dodgy-imports"
                    "-Wduplicate-constraints"
                    "-Wno-duplicate-constraints"
                    "-Wduplicate-exports"
                    "-Wno-duplicate-exports"
                    "-Wempty-enumerations"
                    "-Wno-empty-enumerations"
                    "-Werror"
                    "-Wwarn"
                    "-Weverything"
                    "-Whi-shadowing"
                    "-Wno-hi-shadowing"
                    "-Widentities"
                    "-Wno-identities"
                    "-Wimplicit-prelude"
                    "-Wno-implicit-prelude"
                    "-Wincomplete-patterns"
                    "-Wno-incomplete-patterns"
                    "-Wincomplete-record-updates"
                    "-Wno-incomplete-record-updates"
                    "-Wincomplete-uni-patterns"
                    "-Wno-incomplete-uni-patterns"
                    "-Winline-rule-shadowing"
                    "-Wno-inline-rule-shadowing"
                    "-Wmissed-specialisations"
                    "-Wno-missed-specialisations"
                    "-Wmissing-export-lists"
                    "-fnowarn-missing-export-lists"
                    "-Wmissing-exported-signatures"
                    "-Wno-missing-exported-signatures"
                    "-Wmissing-exported-sigs"
                    "-Wno-missing-exported-sigs"
                    "-Wmissing-fields"
                    "-Wno-missing-fields"
                    "-Wmissing-home-modules"
                    "-Wno-missing-home-modules"
                    "-Wmissing-import-lists"
                    "-fnowarn-missing-import-lists"
                    "-Wmissing-local-signatures"
                    "-Wno-missing-local-signatures"
                    "-Wmissing-local-sigs"
                    "-Wno-missing-local-sigs"
                    "-Wmissing-methods"
                    "-Wno-missing-methods"
                    "-Wmissing-monadfail-instances"
                    "-Wno-missing-monadfail-instances"
                    "-Wmissing-pattern-synonym-signatures"
                    "-Wno-missing-pattern-synonym-signatures"
                    "-Wmissing-signatures"
                    "-Wno-missing-signatures"
                    "-Wmonomorphism-restriction"
                    "-Wno-monomorphism-restriction"
                    "-Wname-shadowing"
                    "-Wno-name-shadowing"
                    "-Wno-compat"
                    "-Wcompat"
                    "-Wnoncanonical-monad-instances"
                    "-Wno-noncanonical-monad-instances"
                    "-Wnoncanonical-monadfail-instances"
                    "-Wno-noncanonical-monadfail-instances"
                    "-Wnoncanonical-monoid-instances"
                    "-Wno-noncanonical-monoid-instances"
                    "-Worphans"
                    "-Wno-orphans"
                    "-Woverflowed-literals"
                    "-Wno-overflowed-literals"
                    "-Woverlapping-patterns"
                    "-Wno-overlapping-patterns"
                    "-Wpartial-fields"
                    "-Wno-partial-fields"
                    "-Wpartial-type-signatures"
                    "-Wno-partial-type-signatures"
                    "-Wredundant-constraints"
                    "-Wno-redundant-constraints"
                    "-Wsafe"
                    "-Wno-safe"
                    "-Wsemigroup"
                    "-Wno-semigroup"
                    "-Wsimplifiable-class-constraints"
                    "-Wno-overlapping-patterns"
                    "-Wtabs"
                    "-Wno-tabs"
                    "-Wtrustworthy-safe"
                    "-Wno-safe"
                    "-Wtype-defaults"
                    "-Wno-type-defaults"
                    "-Wtyped-holes"
                    "-Wno-typed-holes"
                    "-Wunbanged-strict-patterns"
                    "-Wno-unbanged-strict-patterns"
                    "-Wunrecognised-pragmas"
                    "-Wno-unrecognised-pragmas"
                    "-Wunrecognised-warning-flags"
                    "-Wno-unrecognised-warning-flags"
                    "-Wunsafe"
                    "-Wno-unsafe"
                    "-Wunsupported-calling-conventions"
                    "-Wno-unsupported-calling-conventions"
                    "-Wunsupported-llvm-version"
                    "-Wno-monomorphism-restriction"
                    "-Wunticked-promoted-constructors"
                    "-Wno-unticked-promoted-constructors"
                    "-Wunused-binds"
                    "-Wno-unused-binds"
                    "-Wunused-do-bind"
                    "-Wno-unused-do-bind"
                    "-Wunused-foralls"
                    "-Wno-unused-foralls"
                    "-Wunused-imports"
                    "-Wno-unused-imports"
                    "-Wunused-local-binds"
                    "-Wno-unused-local-binds"
                    "-Wunused-matches"
                    "-Wno-unused-matches"
                    "-Wunused-pattern-binds"
                    "-Wno-unused-pattern-binds"
                    "-Wunused-top-binds"
                    "-Wno-unused-top-binds"
                    "-Wunused-type-patterns"
                    "-Wno-unused-type-patterns"
                    "-Wwarn"
                    "-Werror"
                    "-Wwarnings-deprecations"
                    "-Wno-warnings-deprecations"
                    "-Wwrong-do-bind"
                    "-Wno-wrong-do-bind"

                    "-fcall-arity"
                    "-fno-call-arity"
                    "-fcase-folding"
                    "-fno-case-folding"
                    "-fcase-merge"
                    "-fno-case-merge"
                    "-fcmm-elim-common-blocks"
                    "-fno-cmm-elim-common-blocks"
                    "-fcmm-sink"
                    "-fno-cmm-sink"
                    "-fcpr-anal"
                    "-fno-cpr-anal"
                    "-fcross-module-specialise"
                    "-fno-cross-module-specialise"
                    "-fcse"
                    "-fno-cse"
                    "-fdicts-cheap"
                    "-fno-dicts-cheap"
                    "-fdicts-strict"
                    "-fno-dicts-strict"
                    "-fdmd-tx-dict-sel"
                    "-fno-dmd-tx-dict-sel"
                    "-fdo-eta-reduction"
                    "-fno-do-eta-reduction"
                    "-fdo-lambda-eta-expansion"
                    "-fno-do-lambda-eta-expansion"
                    "-feager-blackholing"
                    "-fenable-rewrite-rules"
                    "-fno-enable-rewrite-rules"
                    "-fexcess-precision"
                    "-fno-excess-precision"
                    "-fexitification"
                    "-fno-exitification"
                    "-fexpose-all-unfoldings"
                    "-fno-expose-all-unfoldings"
                    "-ffloat-in"
                    "-fno-float-in"
                    "-ffull-laziness"
                    "-fno-full-laziness"
                    "-ffun-to-thunk"
                    "-fno-fun-to-thunk"
                    "-fignore-asserts"
                    "-fno-ignore-asserts"
                    "-fignore-interface-pragmas"
                    "-fno-ignore-interface-pragmas"
                    "-flate-dmd-anal"
                    "-fno-late-dmd-anal"
                    "-fliberate-case"
                    "-fno-liberate-case"
                    "-fliberate-case-threshold="
                    "-fno-liberate-case-threshold"
                    "-fllvm-pass-vectors-in-regs"
                    "-fno-llvm-pass-vectors-in-regs"
                    "-floopification"
                    "-fno-loopification"
                    "-fmax-inline-alloc-size="
                    "-fmax-inline-memcpy-insns="
                    "-fmax-inline-memset-insns="
                    "-fmax-relevant-binds="
                    "-fno-max-relevant-bindings"
                    "-fmax-simplifier-iterations="
                    "-fmax-uncovered-patterns="
                    "-fmax-valid-substitutions="
                    "-fno-max-valid-substitutions"
                    "-fmax-worker-args="
                    "-fno-opt-coercion"
                    "-fno-pre-inlining"
                    "-fno-state-hack"
                    "-fomit-interface-pragmas"
                    "-fno-omit-interface-pragmas"
                    "-fomit-yields"
                    "-fno-omit-yields"
                    "-foptimal-applicative-do"
                    "-fno-optimal-applicative-do"
                    "-fpedantic-bottoms"
                    "-fno-pedantic-bottoms"
                    "-fregs-graph"
                    "-fno-regs-graph"
                    "-fregs-iterative"
                    "-fno-regs-iterative"
                    "-fsimpl-tick-factor="
                    "-fsimplifier-phases="
                    "-fsolve-constant-dicts"
                    "-fno-solve-constant-dicts"
                    "-fspec-constr"
                    "-fno-spec-constr"
                    "-fspec-constr-count="
                    "-fno-spec-constr-count"
                    "-fspec-constr-keen"
                    "-fno-spec-constr-keen"
                    "-fspec-constr-threshold="
                    "-fno-spec-constr-threshold"
                    "-fspecialise"
                    "-fno-specialise"
                    "-fspecialise-aggressively"
                    "-fno-specialise-aggressively"
                    "-fstatic-argument-transformation"
                    "-fno-static-argument-transformation"
                    "-fstg-cse"
                    "-fno-stg-cse"
                    "-fstrictness"
                    "-fno-strictness"
                    "-fstrictness-before="
                    "-funbox-small-strict-fields"
                    "-fno-unbox-small-strict-fields"
                    "-funbox-strict-fields"
                    "-fno-unbox-strict-fields"
                    "-funfolding-creation-threshold="
                    "-funfolding-dict-discount="
                    "-funfolding-fun-discount="
                    "-funfolding-keeness-factor="
                    "-funfolding-use-threshold="
                    "-fvectorisation-avoidance"
                    "-fno-vectorisation-avoidance"
                    "-fvectorise"
                    "-fno-vectorise"

                    "-fno-prof-auto"
                    "-fprof-auto"
                    "-fno-prof-cafs"
                    "-fprof-cafs"
                    "-fno-prof-count-entries"
                    "-fprof-count-entries"
                    "-fprof-auto"
                    "-fno-prof-auto"
                    "-fprof-auto-calls"
                    "-fno-prof-auto-calls"
                    "-fprof-auto-exported"
                    "-fno-prof-auto"
                    "-fprof-auto-top"
                    "-fno-prof-auto"
                    "-fprof-cafs"
                    "-fno-prof-cafs"
                    "-prof"
                    "-ticky"

                    "-fhpc"

                    "-cpp"
                    "-D"
                    "-U"

                    "-dynamic-too"
                    "-fasm"
                    "-fllvm"
                    "-fbyte-code"
                    "-fno-code"
                    "-fobject-code"
                    "-fPIC"
                    "-fPIE"
                    "-fwrite-interface"

                    "-c"
                    "-debug"
                    "-dylib-install-name"
                    "-dynamic"
                    "-dynload"
                    "-eventlog"
                    "-fno-embed-manifest"
                    "-fno-gen-manifest"
                    "-fno-shared-implib"
                    "-framework"
                    "-framework-path"
                    "-fwhole-archive-hs-libs"
                    "-l"
                    "-main-is"
                    "-no-hs-main"
                    "-no-rtsopts-suggestions"
                    "-package"
                    "-pie"
                    "-rdynamic"
                    "-shared"
                    "-split-objs"
                    "-split-sections"
                    "-static"
                    "-staticlib"
                    "-threaded"
                    "-with-rtsopts="

                    "-fplugin-opt="
                    "-fplugin="
                    "-hide-all-plugin-packages"
                    "-plugin-package"
                    "-plugin-package-id"

                    "-pgma"
                    "-pgmc"
                    "-pgmdll"
                    "-pgmF"
                    "-pgmi"
                    "-pgmL"
                    "-pgml"
                    "-pgmlc"
                    "-pgmlibtool"
                    "-pgmlo"
                    "-pgmP"
                    "-pgms"
                    "-pgmwindres"

                    "-opta"
                    "-optc"
                    "-optdll"
                    "-optF"
                    "-opti"
                    "-optL"
                    "-optl"
                    "-optlc"
                    "-optlo"
                    "-optP"
                    "-optwindres"

                    "-msse2"
                    "-msse4.2"

                    "-dcmm-lint"
                    "-dcore-lint"
                    "-ddump-asm"
                    "-ddump-asm-expanded"
                    "-ddump-asm-liveness"
                    "-ddump-asm-native"
                    "-ddump-asm-regalloc"
                    "-ddump-asm-regalloc-stages"
                    "-ddump-asm-stats"
                    "-ddump-bcos"
                    "-ddump-cmm"
                    "-ddump-cmm-caf"
                    "-ddump-cmm-cbe"
                    "-ddump-cmm-cfg"
                    "-ddump-cmm-cps"
                    "-ddump-cmm-from-stg"
                    "-ddump-cmm-info"
                    "-ddump-cmm-proc"
                    "-ddump-cmm-procmap"
                    "-ddump-cmm-raw"
                    "-ddump-cmm-sink"
                    "-ddump-cmm-sp"
                    "-ddump-cmm-split"
                    "-ddump-cmm-switch"
                    "-ddump-cmm-verbose"
                    "-ddump-core-stats"
                    "-ddump-cse"
                    "-ddump-deriv"
                    "-ddump-ds"
                    "-ddump-ec-trace"
                    "-ddump-foreign"
                    "-ddump-if-trace"
                    "-ddump-inlinings"
                    "-ddump-json"
                    "-ddump-llvm"
                    "-ddump-occur-anal"
                    "-ddump-opt-cmm"
                    "-ddump-parsed"
                    "-ddump-parsed-ast"
                    "-ddump-prep"
                    "-ddump-rn"
                    "-ddump-rn-ast"
                    "-ddump-rn-stats"
                    "-ddump-rn-trace"
                    "-ddump-rule-firings"
                    "-ddump-rule-rewrites"
                    "-ddump-rules"
                    "-ddump-simpl"
                    "-ddump-simpl-iterations"
                    "-ddump-simpl-stats"
                    "-ddump-spec"
                    "-ddump-splices"
                    "-ddump-stg"
                    "-ddump-str-signatures"
                    "-ddump-stranal"
                    "-ddump-tc"
                    "-ddump-tc-ast"
                    "-ddump-tc-trace"
                    "-ddump-timings"
                    "-ddump-to-file"
                    "-ddump-types"
                    "-ddump-vect"
                    "-ddump-vt-trace"
                    "-ddump-worker-wrapper"
                    "-dfaststring-stats"
                    "-dinitial-unique="
                    "-dno-debug-output"
                    "-ddebug-output"
                    "-dppr-case-as-let"
                    "-dppr-cols="
                    "-dppr-debug"
                    "-dppr-user-length"
                    "-dshow-passes"
                    "-dstg-lint"
                    "-dsuppress-all"
                    "-dsuppress-coercions"
                    "-dsuppress-idinfo"
                    "-dsuppress-module-prefixes"
                    "-dsuppress-stg-free-vars"
                    "-dsuppress-ticks"
                    "-dsuppress-type-applications"
                    "-dsuppress-type-signatures"
                    "-dsuppress-unfoldings"
                    "-dsuppress-uniques"
                    "-dsuppress-var-kinds"
                    "-dunique-increment"
                    "-dverbose-core2core"
                    "-dverbose-stg2stg"
                    "-falignment-sanitisation"
                    "-fcatch-bottoms"
                    "-fllvm-fill-undef-with-garbage"
                    "-g"

                    "-fexternal-interpreter"
                    "-fglasgow-exts"
                    "-fno-glasgow-exts"
                    "-ghcversion-file"
                    "-H"
                    "-j")))))))

(provide 'shell-completion-ghc-flags)

;; Local Variables:
;; End:

;; shell-completion-ghc-flags.el ends here
